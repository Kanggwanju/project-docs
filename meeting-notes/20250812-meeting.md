# 📌 2025년 8월 12일 독서 소모임 프로젝트 회의록


모임 목록에서 모임 상태를 기준으로 필터링 함
-> 필터링한 목록들 나옴 ex) 모집, 종료, 취소

모임 목록에서 필터링 할 때 모임 상태를 정하지 않음
-> 모집중인 모임들만 나옴

API 응답 DTO 구현

PR 진행
feat: #30 모임 리스트 조회 API, Repository 작성
## 개요
- 모임 리스트 조회 API를 구현하기 위한 Repository를 작성하였습니다.
- 그 과정에서 DB 통신은 QueryDSL을 사용하였고, 필터링과 정렬을 이용한 조회를 테스트하였습니다.

## 변경 사항
1. QueryDSL
- build.gradle, QueryDSL 설정을 위한 종속성 추가
- QueryDSL 설정 클래스 추가(QueryDslConfig.java)
- QueryDSL 사용을 위한 커스텀 레포지토리(MeetingRepositoryCustom) 추가 및
  구현체 생성(MeetingRepositoryImpl)

2. 모임 리스트를 필터링, 정렬을 통해 조회 (MeetingRepositoryImpl)
- 조건: region(시/도), city(시/구/군), genre(모임 장르), status(모집, 종료, 취소),
  sortBy(최신순, 미팅 시간 임박 순서, 방장의 인기 순서)
- 기본적으로 status는 모집으로 설정하여, 모집 종료 취소가 복잡하게 섞여서 보이는 상황을
  미리 제한함.

3. 테스트
- MeetingListTest.java 파일에서 진행


## 테스트 방법
- 로컬에서 직접 정렬과 필터링 테스트 케이스를 작성
- BDD(given-when-then) 스타일, QueryDsl로 MeetingRepositoryCustom을  간단하게 테스트

## 관련 이슈
- Resolves #30 

---

문제 - 미팅 시간이 지난 모임은 데이터베이스에서 
미팅의 상태를 모집 상태 -> 종료 상태로 어떻게 만들것인가?

자동화가 필요하기 때문에 **스케줄링**이 필요

## 스케줄러(Spring Boot 예시)로 주기적 자동 처리

Spring Boot를 쓴다면 `@Scheduled`를 활용해 매일 또는 매시간 실행되게 할 수 있습니다.

```java
@Service
@RequiredArgsConstructor
public class MeetingStatusScheduler {

    private final MeetingRepository meetingRepository;

    // 매일 새벽 1시에 실행
    @Scheduled(cron = "0 0 1 * * *")
    @Transactional
    public void updateEndedMeetings() {
        meetingRepository.updateEndedMeetings();
    }
}
```

Repository에 쿼리 메서드 작성:

```java
public interface MeetingRepository extends JpaRepository<Meeting, Long> {

    @Modifying
    @Query("UPDATE Meeting m " +
           "SET m.status = 'ENDED' " +
           "WHERE m.status = 'RECRUITING' " +
           "AND m.meetingTime < CURRENT_TIMESTAMP")
    int updateEndedMeetings();
}
```

**장점**

* 배치 작업처럼 정해진 시간에 자동으로 실행됨
* 관리자가 신경 안 써도 데이터 최신 상태 유지

---

## 요약

* **즉시 변경**: `UPDATE` SQL 실행
* **자동 변경**: 스케줄러(`@Scheduled`) + 쿼리 메서드
* 운영환경에서는 스케줄러 주기(매일/매시간)와 트랜잭션 처리 주의
* 대규모 데이터면 인덱스(`meeting_time`, `status`) 걸어서 성능 최적화


---

`@Scheduled` 같은 스케줄러 방식은 **서버가 켜져 있는 상태에서만** 동작

즉,

* 새벽 1시에 실행되도록 설정했는데
* **그 시간에 톰캣(서버)이 꺼져 있다면 → 작업이 실행되지 않음**

---

## 해결 방법 3가지

1. **서버 항상 켜두기**

  * AWS EC2, 클라우드 서버, 또는 운영 서버에 항상 배포해두고 실행
  * 스케줄러가 정해진 시간마다 자동으로 동작

2. **DB 자체의 스케줄러 사용**

  * MySQL 이벤트 스케줄러 예시:

    ```sql
    CREATE EVENT IF NOT EXISTS update_meeting_status
    ON SCHEDULE EVERY 1 HOUR
    DO
      UPDATE meeting
      SET status = 'ENDED'
      WHERE status = 'RECRUITING'
        AND meeting_time < NOW();
    ```
  * DB가 켜져 있으면 애플리케이션 서버가 꺼져 있어도 자동으로 처리됩니다.

3. **외부 배치/크론 잡 사용**

  * 리눅스 서버에서 `cron`으로 매일 새벽 1시에 실행
  * 또는 Jenkins, GitHub Actions 같은 CI/CD 도구를 이용해 실행

---

💡 **정리**

* `@Scheduled` → 서버가 꺼져 있으면 작동 ❌
* MySQL 이벤트 스케줄러 or cron → 서버 꺼져도 DB만 살아있으면 작동 ⭕
* 운영환경에서는 서버 유지 + 배치 프로세스 or DB 스케줄러 혼합해서 쓰는 경우 많음


